<%= form_with(model: task, class: "space-y-6", data: { controller: "project-selector" }) do |form| %>
  <% if task.errors.any? %>
    <div role="alert" class="bg-red-900/50 border border-red-500 text-red-200 px-4 py-3 rounded-md">
      <h2 class="font-bold mb-2">
        <%= pluralize(task.errors.count, "erro encontrado", "erros encontrados") %>:
      </h2>
      <ul class="list-disc list-inside space-y-1">
        <% task.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= form.label :name, "Nome da Tarefa", class: "block text-sm font-medium text-gray-300 mb-1" %>
    <%= form.text_field :name,
        required: true,
        "aria-required": "true",
        class: "mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2",
        placeholder: "Nome da tarefa" %>
  </div>

  <div>
    <%= form.label :company_id, "Empresa", class: "block text-sm font-medium text-gray-300 mb-1" %>
    <%= form.collection_select :company_id, companies, :id, :name,
        { prompt: "Selecione uma empresa" },
        {
          required: true,
          "aria-required": "true",
          class: "mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2",
          data: { project_selector_target: "companySelect", action: "change->project-selector#loadProjects" }
        } %>
  </div>

  <div>
    <%= form.label :project_id, "Projeto", class: "block text-sm font-medium text-gray-300 mb-1" %>
    <%= form.select :project_id,
        [],
        { prompt: "Selecione uma empresa primeiro" },
        {
          required: true,
          "aria-required": "true",
          class: "mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2",
          data: { project_selector_target: "projectSelect" },
          disabled: true
        } %>
    <p class="mt-1 text-sm text-gray-400" id="project-hint"></p>
  </div>

  <div>
    <%= form.label :start_date, "Data de Início", class: "block text-sm font-medium text-gray-300 mb-1" %>
    <%= form.date_field :start_date,
        required: true,
        value: Date.today,
        "aria-required": "true",
        class: "mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2" %>
  </div>

  <div>
    <%= form.label :estimated_hours, "Horas Estimadas", class: "block text-sm font-medium text-gray-300 mb-1" %>
    <%= form.number_field :estimated_hours,
        required: true,
        step: 0.01,
        min: 0.01,
        "aria-required": "true",
        class: "mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2",
        placeholder: "8.0" %>
  </div>

  <div>
    <%= form.label :notes, "Observações", class: "block text-sm font-medium text-gray-300 mb-1" %>
    <%= form.text_area :notes,
        rows: 3,
        class: "mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2",
        placeholder: "Observações sobre a tarefa (opcional)" %>
  </div>

  <div class="flex flex-col sm:flex-row gap-3 pt-4">
    <%= form.submit "Criar Tarefa",
        class: "bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md text-sm font-medium transition min-h-[44px] cursor-pointer",
        data: { action: "click->project-selector#validateBeforeSubmit" } %>
    <%= link_to "Cancelar", root_path,
        class: "bg-gray-600 hover:bg-gray-500 text-white px-6 py-2 rounded-md text-sm font-medium transition min-h-[44px] inline-flex items-center justify-center" %>
  </div>
<% end %>
